## 자바스크립트 엔진이 코드를 실행하는 과정
---
[참고 글](https://meetup.toast.com/posts/89)

> 자바스크립트는 인터프리터 언어 이다.

인터프리터란?
* 인터프리터(해석기)란 소스코드를 바로 실행하는 컴퓨터 프로그램 또는 환경
* 소스코드를 목적코드로 옮기는 컴파일과 다름
* 인터프리터는 소스코드를 한줄 한줄 읽어들이면서 실행하는 프로그램
* 인터프리터에서는 번역과 실행이 동시에 이루어진다.
* 컴파일이 없기 때문에 별도의 컴파일 시간이 없다.
![인터프리터 동작](https://t1.daumcdn.net/cfile/tistory/2458A34757F9C71523)

> 자바스크립트 엔진(V8)

![자바스크립트 엔진](https://github.com/baeharam/Must-Know-About-Frontend/blob/main/images/javascript/engine-overview.png?raw=true)

* 자바스크립트 엔진의 대표적인 예는 Google V8 엔진
* 자바스크립트는 **싱글스레드 콜백큐 사용**
* V8은 크롬과 Node.js에서 사용
* 자바스크립트 엔진 구조는 메모리 힙(Memory Heap)과 콜 스택(Call Stack)으로 이루어짐

![엔진](https://joshua1988.github.io/images/posts/web/translation/how-js-works/js-engine-structure.png)

* Memory Heap : 메모리 할당이 일어나는 곳
* Call Satck : 코드 실행에 따라 호출 스택이 쌓이는 곳

> 런타임

![자바스크립트 런타임환경](https://joshua1988.github.io/images/posts/web/translation/how-js-works/js-engine-runtime.png)

1. 웹에서 제공하는 Web Apis,
2. 자바스크립트 엔진인 메모리힙과 콜 스택
3. 이벤트 루프와 콜백 큐

## **호출스택**

**싱글스레드 기반 언어,**

싱글 스레드란? 하나의 호출에는 하나의 응답만 할 수 있음

ex) 파일 1개 다운로드 -> 1개 다운로드 -> 1개 다운로드


- 호출스택은 기본적으로 우리가 프로그램 상에서 어디에 있는지를 기록하는 자료구조

- 만약 함수를 실행하면 해당함수는 호출 스택의 가장 상단에 위치함,
- 함수의 실행이 끝날 때(리턴 값을 돌려줄 때) 해당 함수를 호출 스택에서 제거 합니다. 

## **동시성 & 이벤트 루프** 
호출 스택에서 처리 시간이 어마어마하게 오래 걸리는 함수가 있으면 무슨일이 발생할까요?

매우 복잡한 이미지 프로세싱 작업을 한다고 예를 들었을 때

브라우저는 호출스택에서 해당 함수가 실행되는 동안 아무 작업도 못하고 대기 상태가 됩니다.

이 문제에서 등장하는 개념이 **동시성과 이벤트 루프** 입니다.

동시성에 대한 처리는 자바스크립트 엔진을 구동하는 환경, 즉 브라우저나 Node.js가 담당합니다.

브라우저 환경을 간단하게 그림으로 표현하면
![브라우저환경](https://image.toast.com/aaaadh/real/2018/techblog/b1493856379d11e69c16a9a4cf841567.png)

위 그림에서 볼 수 있듯이 실제로 우리가 비동기 호출을 위해 사용하는 setTimeout 이나 XMLHttpRequest 와 같은 함수들은 자바스크립트 엔진이 아닌 Web Api 영역에 따로 정의 되어 있음,

이벤트 루프와 태스트 콜(콜백 큐)와 같은 장치오 자바스크립트 엔진 외부에 구현되어 있음

> 태스트 큐(콜백큐)

setTimeout 함수를 통해 넘긴 함수는 어떻게 그 전 함수가 끝나자마자 실행 될 수 있을까? 여기서 태스크 큐와 이벤트루프가 등장한다.
태스트 큐는 말 그대로 콜백 함수들이 대기하는 큐(FIFO)형태의 배열이라 할 수 있고, 이벤트 루프는 호출 스택이 비워질 때 마다 큐에서 콜백 함수를 꺼내와서 실행하느 역할을 함